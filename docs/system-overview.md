# システム全体の仕組み — 導入前 vs 導入後

---

## まず「何のシステムか」

これは**オンラインライブバカラ**の裏側の仕組みです。

実際のカジノテーブルにディーラーがいて、本物のカードを使ってゲームを進行します。その様子をカメラで撮影し、インターネット経由でプレイヤーに配信します。プレイヤーはスマホやPCから賭けに参加します。

---

## 登場する人・モノ

| 名称 | 説明 |
|---|---|
| 👤 ディーラー | カードを配る人（現場にいる） |
| 👥 プレイヤー | オンラインで賭ける人（世界中にいる） |
| 🃏 カード | 本物のトランプ（RFIDチップ内蔵） |
| 📖 RFIDリーダー | カードを読み取る機械（カードを置くだけで識別） |
| 📹 カメラ | テーブルを撮影 |
| 🖥️ ディーラーPC | ディーラーの手元にあるパソコン |

---

## このシステムがない場合（現在の運用）

```
┌─────────────────────────────────────────────────────────┐
│                    カジノテーブル（現場）                    │
│                                                         │
│   👤 ディーラー                                          │
│    │                                                    │
│    ├─→ 🃏 カードを配る                                   │
│    │    └─→ 📖 RFIDリーダーが読み取り                     │
│    │         └─→ 🖥️ ディーラーPC                         │
│    │              └─→ dealer_v5（NEXUS9社の専用アプリ）    │
│    │                                                    │
│    └─→ 📹 カメラで撮影                                   │
│         └─→ OBS（配信ソフト）                             │
└─────────┬───────────────────────────┬───────────────────┘
          │                           │
          ▼                           ▼
   ┌─────────────┐           ┌──────────────┐
   │ ゲームサーバー │           │ 配信サーバー    │
   │  (NEXUS9管理) │           │ (映像ストリーム) │
   │              │           └──────┬───────┘
   │ ・ベット管理   │                  │
   │ ・勝敗判定    │                  │
   │ ・配当計算    │                  ▼
   └──────┬───────┘           👥 プレイヤーの画面
          │                   ┌──────────────┐
          └──────────────────→│ ライブ映像     │
                              │ ＋ベットボタン  │
                              │ ＋結果表示     │
                              └──────────────┘
```

### 流れ

1. **ディーラーがカードを配る** — 本物のカードをテーブルに出す
2. **RFIDリーダーが読み取る** — カードにはチップが埋め込まれており、置くだけで「♠7」「♥K」などと識別される
3. **dealer_v5が受け取る** — NEXUS9社が作った専用ソフト（Windows用）が、読み取ったカード情報を画面に表示
4. **ディーラーが操作する** — dealer_v5でSTART（ゲーム開始）→ カードスキャン → RESULT（結果送信）ボタンを押す
5. **ゲームサーバーに送信** — カード情報と結果がNEXUS9のサーバーに送られる
6. **プレイヤーに反映** — サーバーが勝敗を確定し、プレイヤーの画面に結果が表示され、配当が支払われる
7. **映像は別ルート** — カメラ映像はOBSという配信ソフトを通じて、別の配信サーバーからプレイヤーに届く

### この運用の問題点

| 問題 | 説明 |
|---|---|
| **データが手元に残らない** | ゲーム結果はNEXUS9のサーバーにしか保存されない。自分たちで確認・検証できない |
| **専用ソフト依存** | dealer_v5はNEXUS9が作ったWindows専用アプリ。カスタマイズ不可、ブラウザで使えない |
| **不正検知ができない** | カードデータの独自記録がないため、ディーラーの不正や集計ミスを自分たちで検出できない |
| **運用の柔軟性がない** | ソフトの改修・機能追加はNEXUS9に依頼するしかない |

---

## このシステムを組み入れた場合

```
┌──────────────────────────────────────────────────────────────┐
│                     カジノテーブル（現場）                       │
│                                                              │
│   👤 ディーラー                                               │
│    │                                                         │
│    ├─→ 🃏 カードを配る                                        │
│    │    └─→ 📖 RFIDリーダーが読み取り                          │
│    │         │                                               │
│    │         ├─→ 🖥️ dealer_v5（従来通り動作）                  │
│    │         │    └─→ ゲームサーバーへ送信                      │
│    │         │                                               │
│    │         └─→ 💻 ★ 新ディーラーシステム ★                   │
│    │              │                                          │
│    │              ├─→ カード情報を自社データベースに保存          │
│    │              ├─→ ゲームサーバーのデータをリアルタイム受信     │
│    │              └─→ 自社サーバーにデータ転送                   │
│    │                                                         │
│    └─→ 📹 カメラ → OBS → 配信サーバー（従来通り）               │
└──────────┬──────────────────────┬────────────────────────────┘
           │                      │
           ▼                      ▼
    ┌─────────────┐      ┌──────────────────┐
    │ ゲームサーバー │ ←──→ │ ★新システム       │
    │  (NEXUS9管理) │  WS  │                  │
    │              │ 接続  │ ・自社データベース  │
    └──────┬───────┘      │ ・データ転送機能   │
           │              │ ・Web管理画面      │
           ▼              └──────────────────┘
    👥 プレイヤーの画面
    （従来通り変化なし）
```

### 2つの運用モード

#### Passiveモード（監視モード）— dealer_v5と併用

```
dealer_v5（従来） ──操作──→ ゲームサーバー
                                ↑
新システム ──── WS受信のみ ──────┘
  └─→ データ記録・転送（自動）
```

- ディーラーはdealer_v5を今まで通り使う（操作方法は変わらない）
- 新システムはゲームサーバーからデータを**受信するだけ**（操作しない）
- 受信したカード情報・ゲーム結果を**自動で記録・転送**
- **現在の運用を一切変えずに導入できる**

#### Activeモード（完全置換）— dealer_v5の代わり

```
新システム ──操作＋データ記録──→ ゲームサーバー
（dealer_v5は使わない）
```

- 新システムがdealer_v5の役割を完全に引き継ぐ
- ディーラーはブラウザ画面からSTART/RESULTなどを操作
- RFIDカードスキャンも新システムが直接処理
- **Webブラウザで動くため、Windows以外でも使える**

---

## 導入後に何が変わるか

| 項目 | 導入前 | 導入後 |
|---|---|---|
| **データの所在** | NEXUS9のサーバーのみ | 自社データベースにも保存 |
| **データの確認** | NEXUS9に依頼が必要 | 自分たちでいつでも確認可能 |
| **不正検知** | できない | カード履歴を独自に記録・検証可能 |
| **カスタマイズ** | NEXUS9に依頼 | 自分たちで自由に改修可能 |
| **外部連携** | なし | 自社サーバーへ自動データ転送 |
| **使用端末** | Windows PC + 専用アプリ | ブラウザがあれば何でもOK |
| **プレイヤーへの影響** | — | **なし**（裏側の変更のみ） |

---

## 一番大きなメリット: 「自分たちのデータを持てる」

```
 従来:                           導入後:

 カード → NEXUS9 → プレイヤー    カード → NEXUS9 → プレイヤー
          ↑                              ↑
        データは                   ★ 自社DB にも保存 ★
        ここだけ                     ├─ 全ラウンドの記録
                                    ├─ カード1枚ずつの履歴
                                    ├─ 勝敗・スコア
                                    └─ タイムスタンプ
```

これにより：

- **集計** — 1日のゲーム数、勝率、ナチュラル率などを自分で集計
- **監査** — ディーラーの操作ログとカード履歴を照合して不正チェック
- **分析** — ゲームデータを使った統計分析やレポート作成
- **証跡** — トラブル時の証拠データとして保全

---

## プレイヤーから見た変化

**何も変わりません。**

新システムは完全に裏側（ディーラー側・管理側）の仕組みです。プレイヤーが見るライブ映像、ベット画面、結果表示はすべて従来通りです。
